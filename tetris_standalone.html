<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Ç—Ä–∏—Å</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body {
            background: linear-gradient(135deg, #6e45e2, #88d3ce);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            color: white;
            overflow: hidden;
        }
        
        .game-container {
            display: flex;
            flex-direction: row;
            gap: 20px;
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 900px;
            width: 100%;
        }
        
        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 200px;
        }
        
        .score-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        h1 {
            font-size: 2em;
            margin: 0 0 20px 0;
            text-align: center;
            animation: pulse 2s infinite;
        }
        
        canvas {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            image-rendering: pixelated;
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            border: none;
            padding: 12px 20px;
            font-size: 1.2em;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            font-weight: bold;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .controls-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        .controls-info h3 {
            margin-top: 0;
            text-align: center;
        }
        
        .controls-info p {
            margin: 8px 0;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .sparkle {
            position: absolute;
            width: 5px;
            height: 5px;
            background: white;
            border-radius: 50%;
            animation: sparkle 1s infinite;
        }
        
        @keyframes sparkle {
            0% { opacity: 0.2; }
            50% { opacity: 1; }
            100% { opacity: 0.2; }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
                height: auto;
                min-height: 100vh;
                overflow-y: auto; /* –†–∞–∑—Ä–µ—à–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É */
            }
            
            .game-container {
                flex-direction: column;
                align-items: center;
                padding: 10px;
                max-width: 100%;
                box-sizing: border-box;
                margin-bottom: 20px; /* –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
            }
            
            .info-panel {
                width: 100%;
                max-width: 300px;
                order: 2;
            }
            
            canvas#tetris {
                max-width: 100%;
                height: auto !important; /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤—ã—Å–æ—Ç—É */
                order: 1;
                transform: scale(0.65); /* –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ */
                transform-origin: top center;
                margin-bottom: 40px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
            }
            
            h1 {
                font-size: 1.5em;
                margin-bottom: 10px;
            }
            
            .controls-info {
                font-size: 0.9em;
            }
            
            button {
                padding: 10px;
                font-size: 1em;
            }
            
            /* –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
            @media (max-height: 800px) {
                canvas#tetris {
                    transform: scale(0.5); /* –ï—â–µ —Å–∏–ª—å–Ω–µ–µ —É–º–µ–Ω—å—à–∞–µ–º –¥–ª—è –Ω–∏–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
                    margin-bottom: 0;
                }
                
                .game-container {
                    margin-bottom: 60px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
                }
                
                body {
                    padding-bottom: 80px; /* –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
                }
            }
            
            /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
            @media (max-height: 600px) {
                canvas#tetris {
                    transform: scale(0.4); /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
                }
                
                .mobile-controls {
                    margin-top: 5px; /* –£–º–µ–Ω—å—à–∞–µ–º –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
                }
                
                .mobile-controls button {
                    width: 60px;
                    height: 60px;
                }
                
                #rotate-btn, #drop-btn {
                    width: 120px;
                }
            }
        }
        
        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        html, body {
            overscroll-behavior: contain;
            touch-action: pan-y; /* –†–∞–∑—Ä–µ—à–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É */
            scroll-behavior: smooth; /* –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
        }
        
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 768px) {
            .game-wrapper {
                position: relative;
                width: 100%;
                overflow: visible;
            }
            
            /* –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
            .scroll-indicator {
                display: none; /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç */
                position: fixed;
                bottom: 10px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(255, 255, 255, 0.2);
                color: white;
                padding: 5px 10px;
                border-radius: 20px;
                font-size: 12px;
                z-index: 1000;
                animation: pulse 2s infinite;
                transition: opacity 0.5s;
            }
            
            /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
            @media (max-width: 768px) {
                .scroll-indicator {
                    display: block;
                }
            }
            
            @keyframes pulse {
                0% { opacity: 0.5; }
                50% { opacity: 1; }
                100% { opacity: 0.5; }
            }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .mobile-controls {
            display: none; /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç—ã */
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
            width: 100%;
            max-width: 300px;
        }
        
        .mobile-controls-row {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .mobile-controls button {
            width: 70px;
            height: 70px;
            font-size: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1));
            color: white;
            border: 3px solid rgba(255, 255, 255, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            -webkit-tap-highlight-color: transparent; /* –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø—Ä–∏ —Ç–∞–ø–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            user-select: none; /* –ó–∞–ø—Ä–µ—â–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ */
            transition: transform 0.1s, background 0.1s, box-shadow 0.1s;
        }
        
        .mobile-controls button:active {
            transform: scale(0.9) translateY(4px);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.2));
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        #rotate-btn, #drop-btn {
            width: 140px;
            border-radius: 35px;
            font-weight: bold;
        }
        
        #left-btn {
            background: linear-gradient(135deg, rgba(0, 116, 217, 0.7), rgba(0, 116, 217, 0.4));
            border-color: rgba(0, 116, 217, 0.8);
        }
        
        #right-btn {
            background: linear-gradient(135deg, rgba(0, 116, 217, 0.7), rgba(0, 116, 217, 0.4));
            border-color: rgba(0, 116, 217, 0.8);
        }
        
        #down-btn {
            background: linear-gradient(135deg, rgba(255, 133, 27, 0.7), rgba(255, 133, 27, 0.4));
            border-color: rgba(255, 133, 27, 0.8);
        }
        
        #rotate-btn {
            background: linear-gradient(135deg, rgba(46, 204, 64, 0.7), rgba(46, 204, 64, 0.4));
            border-color: rgba(46, 204, 64, 0.8);
        }
        
        #drop-btn {
            background: linear-gradient(135deg, rgba(255, 65, 54, 0.7), rgba(255, 65, 54, 0.4));
            border-color: rgba(255, 65, 54, 0.8);
        }
        
        /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
        @media (max-width: 768px) {
            .mobile-controls {
                display: flex;
                order: 3;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-wrapper">
            <canvas id="tetris" width="500" height="1000"></canvas>
            <div class="scroll-indicator" id="scroll-indicator">–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –≤–Ω–∏–∑ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ–±–∑–æ—Ä–∞</div>
        </div>
        
        <!-- –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="mobile-controls">
            <div class="mobile-controls-row">
                <button id="rotate-btn">‚Üë</button>
            </div>
            <div class="mobile-controls-row">
                <button id="left-btn">‚Üê</button>
                <button id="down-btn">‚Üì</button>
                <button id="right-btn">‚Üí</button>
            </div>
            <div class="mobile-controls-row">
                <button id="drop-btn">‚¨áÔ∏è‚¨áÔ∏è</button>
            </div>
        </div>
        
        <div class="info-panel">
            <h1>‚ú® –¢–µ—Ç—Ä–∏—Å ‚ú®</h1>
            
            <div class="score-box">
                <p>üèÜ –°—á–µ—Ç: <span id="score">0</span></p>
                <p>üìä –õ–∏–Ω–∏–∏: <span id="lines">0</span></p>
                <p>üöÄ –£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></p>
            </div>
            
            <div class="score-box">
                <p>üé≤ –°–ª–µ–¥—É—é—â–∞—è —Ñ–∏–≥—É—Ä–∞:</p>
                <canvas id="next" width="120" height="120"></canvas>
            </div>
            
            <button id="start">‚ñ∂Ô∏è –°–¢–ê–†–¢</button>
            
            <div class="controls-info">
                <h3>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</h3>
                <p>‚Üê ‚Üí : –î–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ</p>
                <p>‚Üë : –í—Ä–∞—â–µ–Ω–∏–µ</p>
                <p>‚Üì : –î–≤–∏–∂–µ–Ω–∏–µ –≤–Ω–∏–∑</p>
                <p>–ü—Ä–æ–±–µ–ª : –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–≥—É—Ä—É</p>
                <p>P : –ü–∞—É–∑–∞</p>
                <p>–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫: –°—Ç–∞—Ä—Ç/–ü–∞—É–∑–∞</p>
                <h3>üì± –ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</h3>
                <p>–°–≤–∞–π–ø –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ: –î–≤–∏–∂–µ–Ω–∏–µ</p>
                <p>–°–≤–∞–π–ø –≤–≤–µ—Ä—Ö: –í—Ä–∞—â–µ–Ω–∏–µ</p>
                <p>–°–≤–∞–π–ø –≤–Ω–∏–∑: –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–≥—É—Ä—É</p>
                <p>–¢–∞–ø: –î–≤–∏–∂–µ–Ω–∏–µ –≤–Ω–∏–∑</p>
                <p>–î–≤–æ–π–Ω–æ–π —Ç–∞–ø: –°—Ç–∞—Ä—Ç/–ü–∞—É–∑–∞</p>
                <p>–¢–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
            </div>
        </div>
    </div>

    <script>
        // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
        const canvas = document.getElementById('tetris');
        const context = canvas.getContext('2d');
        const nextCanvas = document.getElementById('next');
        const nextContext = nextCanvas.getContext('2d');
        const startButton = document.getElementById('start');
        
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const BLOCK_SIZE = 25; // –†–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
        const ROWS = 40;       // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –≤ 2 —Ä–∞–∑–∞ (–±—ã–ª–æ 20)
        const COLS = 20;       // –®–∏—Ä–æ–∫–∏–π —Å—Ç–∞–∫–∞–Ω
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ö–æ–ª—Å—Ç–∞ –¥–ª—è –∏–¥–µ–∞–ª—å–Ω—ã—Ö –∫–≤–∞–¥—Ä–∞—Ç–æ–≤
        canvas.style.width = `${COLS * BLOCK_SIZE}px`;
        canvas.style.height = `${ROWS * BLOCK_SIZE}px`;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let dropCounter = 0;
        let dropInterval = 1000;
        let lastTime = 0;
        let score = 0;
        let lines = 0;
        let level = 1;
        let paused = false;
        let gameOver = true;
        
        // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
        const arena = createMatrix(COLS, ROWS);
        
        // –ò–≥—Ä–æ–∫
        const player = {
            pos: {x: 0, y: 0},
            matrix: null,
            next: null,
            score: 0
        };
        
        // –¶–≤–µ—Ç–∞ —Ñ–∏–≥—É—Ä —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏ (3D-—ç—Ñ—Ñ–µ–∫—Ç)
        const colors = [
            null,
            {main: '#FF4136', light: '#FF725C', dark: '#E7040F'}, // –ö—Ä–∞—Å–Ω—ã–π
            {main: '#2ECC40', light: '#9EEBCF', dark: '#137752'}, // –ó–µ–ª–µ–Ω—ã–π
            {main: '#0074D9', light: '#7FDBFF', dark: '#00449E'}, // –°–∏–Ω–∏–π
            {main: '#FFDC00', light: '#FFFCEB', dark: '#FFD700'}, // –ñ–µ–ª—Ç—ã–π
            {main: '#B10DC9', light: '#F6D8FF', dark: '#5E2CA5'}, // –§–∏–æ–ª–µ—Ç–æ–≤—ã–π
            {main: '#FF851B', light: '#FFE8D9', dark: '#D86E00'}, // –û—Ä–∞–Ω–∂–µ–≤—ã–π
            {main: '#01FF70', light: '#E8FDF5', dark: '#00A86B'},  // –ë–∏—Ä—é–∑–æ–≤—ã–π
            {main: '#F012BE', light: '#FFCEF3', dark: '#85144b'}, // –†–æ–∑–æ–≤—ã–π
            {main: '#7FDBFF', light: '#E4F9FF', dark: '#0074D9'}, // –ì–æ–ª—É–±–æ–π
            {main: '#39CCCC', light: '#E5FFFF', dark: '#2EAD88'}, // –ê–∫–≤–∞–º–∞—Ä–∏–Ω
            {main: '#3D9970', light: '#C4F9EB', dark: '#1A5336'}, // –û–ª–∏–≤–∫–æ–≤—ã–π
            {main: '#AAAAAA', light: '#EEEEEE', dark: '#666666'}, // –°–µ—Ä—ã–π
            {main: '#FF4136', light: '#FF725C', dark: '#E7040F'}, // –ö—Ä–∞—Å–Ω—ã–π (–ø–æ–≤—Ç–æ—Ä)
            {main: '#2ECC40', light: '#9EEBCF', dark: '#137752'}  // –ó–µ–ª–µ–Ω—ã–π (–ø–æ–≤—Ç–æ—Ä)
        ];
        
        // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã –¢–µ—Ç—Ä–∏—Å–∞
        const standardPieces = [
            // T-–æ–±—Ä–∞–∑–Ω–∞—è —Ñ–∏–≥—É—Ä–∞
            [
                [0, 1, 0],
                [1, 1, 1]
            ],
            // L-–æ–±—Ä–∞–∑–Ω–∞—è —Ñ–∏–≥—É—Ä–∞
            [
                [0, 0, 2],
                [2, 2, 2]
            ],
            // J-–æ–±—Ä–∞–∑–Ω–∞—è —Ñ–∏–≥—É—Ä–∞
            [
                [3, 0, 0],
                [3, 3, 3]
            ],
            // –ö–≤–∞–¥—Ä–∞—Ç
            [
                [4, 4],
                [4, 4]
            ],
            // Z-–æ–±—Ä–∞–∑–Ω–∞—è —Ñ–∏–≥—É—Ä–∞
            [
                [5, 5, 0],
                [0, 5, 5]
            ],
            // –ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞—è T-–æ–±—Ä–∞–∑–Ω–∞—è —Ñ–∏–≥—É—Ä–∞
            [
                [0, 6, 0],
                [6, 6, 6]
            ],
            // S-–æ–±—Ä–∞–∑–Ω–∞—è —Ñ–∏–≥—É—Ä–∞
            [
                [0, 7, 7],
                [7, 7, 0]
            ],
            // I-–æ–±—Ä–∞–∑–Ω–∞—è —Ñ–∏–≥—É—Ä–∞ (–ª–∏–Ω–∏—è)
            [
                [8, 8, 8, 8]
            ]
        ];
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–Ω–¥–æ–º–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã —Ä–∞–∑–º–µ—Ä–æ–º –æ—Ç 1 –¥–æ 4 –±–ª–æ–∫–æ–≤
        const additionalPieces = [
            // –û–¥–∏–Ω–æ—á–Ω—ã–π –±–ª–æ–∫
            [
                [9]
            ],
            // –î–≤–æ–π–Ω—ã–µ –±–ª–æ–∫–∏ (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ)
            [
                [10, 10]
            ],
            [
                [11],
                [11]
            ],
            // –¢—Ä–æ–π–Ω—ã–µ –±–ª–æ–∫–∏ (—Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—ã)
            [
                [12, 12, 12]
            ],
            [
                [13],
                [13],
                [13]
            ],
            [
                [14, 14],
                [14, 0]
            ],
            [
                [15, 15],
                [0, 15]
            ]
        ];
        
        // –§–∏–≥—É—Ä—ã –∏–∑ 5 –±–ª–æ–∫–æ–≤
        const pentominoePieces = [
            // I-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ (–¥–ª–∏–Ω–Ω–∞—è –ª–∏–Ω–∏—è)
            [
                [1, 1, 1, 1, 1]
            ],
            // L-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [2, 0, 0, 0],
                [2, 2, 2, 2]
            ],
            // J-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [0, 0, 0, 3],
                [3, 3, 3, 3]
            ],
            // T-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [0, 4, 0],
                [0, 4, 0],
                [4, 4, 4]
            ],
            // U-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [5, 0, 5],
                [5, 5, 5]
            ],
            // X-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ (–∫—Ä–µ—Å—Ç)
            [
                [0, 6, 0],
                [6, 6, 6],
                [0, 6, 0]
            ],
            // Z-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [7, 7, 0],
                [0, 7, 0],
                [0, 7, 7]
            ],
            // S-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [0, 8, 8],
                [0, 8, 0],
                [8, 8, 0]
            ],
            // P-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [9, 9],
                [9, 9],
                [9, 0]
            ],
            // F-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [0, 10, 10],
                [10, 10, 0],
                [0, 10, 0]
            ]
        ];
        
        // –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —Ñ–∏–≥—É—Ä—ã
        const pieces = [...standardPieces, ...additionalPieces, ...pentominoePieces];
        
        // –§—É–Ω–∫—Ü–∏–∏
        function createMatrix(w, h) {
            const matrix = [];
            while (h--) {
                matrix.push(new Array(w).fill(0));
            }
            return matrix;
        }
        
        function createPiece(type) {
            try {
                console.log("–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–≥—É—Ä—ã —Ç–∏–ø–∞:", type);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ç–∏–ø–∞
                if (type < 0 || type >= pieces.length) {
                    console.error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–∏–ø —Ñ–∏–≥—É—Ä—ã:", type, "–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å:", pieces.length - 1);
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–≤–∞–¥—Ä–∞—Ç (–∏–Ω–¥–µ–∫—Å 3) –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                    return JSON.parse(JSON.stringify(pieces[3]));
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ pieces[type] —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º
                if (!pieces[type] || !Array.isArray(pieces[type])) {
                    console.error("–§–∏–≥—É—Ä–∞ —Å –∏–Ω–¥–µ–∫—Å–æ–º", type, "–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º:", pieces[type]);
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–≤–∞–¥—Ä–∞—Ç (–∏–Ω–¥–µ–∫—Å 3) –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                    return JSON.parse(JSON.stringify(pieces[3]));
                }
                
                // –°–æ–∑–¥–∞–µ–º –≥–ª—É–±–æ–∫—É—é –∫–æ–ø–∏—é —Ñ–∏–≥—É—Ä—ã
                const piece = JSON.parse(JSON.stringify(pieces[type]));
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∏–≥—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
                if (!Array.isArray(piece) || piece.length === 0) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–∏–≥—É—Ä—ã:", piece);
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ—Å—Ç—É—é —Ñ–∏–≥—É—Ä—É –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                    return [[1]];
                }
                
                console.log("–§–∏–≥—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ, —Ä–∞–∑–º–µ—Ä:", piece.length, "x", piece[0].length);
                return piece;
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –≤ createPiece:", e, "stack:", e.stack);
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ—Å—Ç—É—é —Ñ–∏–≥—É—Ä—É –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                return [[1]];
            }
        }
        
        function drawMatrix(matrix, offset, ctx) {
            matrix.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        // –ü–æ–ª—É—á–∞–µ–º —Ü–≤–µ—Ç–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±–ª–æ–∫–∞
                        const colorIndex = value % colors.length;
                        const colorSet = colors[colorIndex === 0 ? 1 : colorIndex];
                        
                        // –†–∏—Å—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫
                        ctx.fillStyle = colorSet.main;
                        ctx.fillRect(
                            (x + offset.x) * BLOCK_SIZE,
                            (y + offset.y) * BLOCK_SIZE,
                            BLOCK_SIZE, BLOCK_SIZE
                        );
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–µ—Å–∫ (—Å–≤–µ—Ç–ª–∞—è —á–∞—Å—Ç—å)
                        ctx.fillStyle = colorSet.light;
                        ctx.fillRect(
                            (x + offset.x) * BLOCK_SIZE,
                            (y + offset.y) * BLOCK_SIZE,
                            BLOCK_SIZE, BLOCK_SIZE / 4
                        );
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–Ω—å (—Ç–µ–º–Ω–∞—è —á–∞—Å—Ç—å)
                        ctx.fillStyle = colorSet.dark;
                        ctx.fillRect(
                            (x + offset.x) * BLOCK_SIZE,
                            (y + offset.y) * BLOCK_SIZE + BLOCK_SIZE * 3/4,
                            BLOCK_SIZE, BLOCK_SIZE / 4
                        );
                        
                        // –†–∏—Å—É–µ–º –≥—Ä–∞–Ω–∏—Ü—É –±–ª–æ–∫–∞
                        ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(
                            (x + offset.x) * BLOCK_SIZE,
                            (y + offset.y) * BLOCK_SIZE,
                            BLOCK_SIZE, BLOCK_SIZE
                        );
                    }
                });
            });
        }
        
        function draw() {
            // –û—á–∏—â–∞–µ–º —Ö–æ–ª—Å—Ç
            context.fillStyle = 'rgba(0, 0, 0, 0.3)';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É
            context.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            context.lineWidth = 1;
            
            for (let x = 0; x <= COLS; x++) {
                context.beginPath();
                context.moveTo(x * BLOCK_SIZE, 0);
                context.lineTo(x * BLOCK_SIZE, ROWS * BLOCK_SIZE);
                context.stroke();
            }
            
            for (let y = 0; y <= ROWS; y++) {
                context.beginPath();
                context.moveTo(0, y * BLOCK_SIZE);
                context.lineTo(COLS * BLOCK_SIZE, y * BLOCK_SIZE);
                context.stroke();
            }
            
            // –†–∏—Å—É–µ–º –∞—Ä–µ–Ω—É
            drawMatrix(arena, {x: 0, y: 0}, context);
            
            // –†–∏—Å—É–µ–º —Ç–µ–∫—É—â—É—é —Ñ–∏–≥—É—Ä—É
            if (player.matrix) {
                drawMatrix(player.matrix, player.pos, context);
            }
            
            // –†–∏—Å—É–µ–º —Å–ª–µ–¥—É—é—â—É—é —Ñ–∏–≥—É—Ä—É
            nextContext.fillStyle = 'rgba(0, 0, 0, 0.3)';
            nextContext.fillRect(0, 0, nextCanvas.width, nextCanvas.height);
            
            if (player.next) {
                const offset = {
                    x: (nextCanvas.width / BLOCK_SIZE - player.next[0].length) / 2,
                    y: (nextCanvas.height / BLOCK_SIZE - player.next.length) / 2
                };
                drawMatrix(player.next, offset, nextContext);
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–∞—É–∑—É
            if (paused) {
                context.fillStyle = 'rgba(0, 0, 0, 0.7)';
                context.fillRect(0, 0, canvas.width, canvas.height);
                
                context.font = '30px Arial';
                context.fillStyle = 'white';
                context.textAlign = 'center';
                context.fillText('–ü–ê–£–ó–ê', canvas.width / 2, canvas.height / 2);
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –æ –¥–≤–æ–π–Ω–æ–º –∫–ª–∏–∫–µ, –µ—Å–ª–∏ –∏–≥—Ä–∞ –Ω–µ –Ω–∞—á–∞—Ç–∞
            if (gameOver) {
                context.fillStyle = 'rgba(0, 0, 0, 0.7)';
                context.fillRect(0, 0, canvas.width, canvas.height);
                
                context.font = '30px Arial';
                context.fillStyle = 'white';
                context.textAlign = 'center';
                context.fillText('–¢–ï–¢–†–ò–°', canvas.width / 2, canvas.height / 2 - 40);
                
                context.font = '20px Arial';
                context.fillStyle = 'rgba(255, 255, 255, 0.8)';
                context.fillText('–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã', canvas.width / 2, canvas.height / 2 + 20);
                
                // –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞
                const pulseSize = 1 + 0.1 * Math.sin(Date.now() / 300);
                context.font = `${Math.floor(24 * pulseSize)}px Arial`;
                context.fillStyle = 'rgba(255, 255, 255, 0.9)';
                context.fillText('üëÜ üëÜ', canvas.width / 2, canvas.height / 2 + 70);
            }
        }
        
        function merge(arena, player) {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
                if (!arena || !player || !player.matrix || !player.pos) {
                    console.error("–û—à–∏–±–∫–∞ –≤ merge: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã", 
                                 "arena:", arena, 
                                 "player:", player);
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–∞—Ç—Ä–∏—Ü–∞ —Ñ–∏–≥—É—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
                if (!Array.isArray(player.matrix) || player.matrix.length === 0) {
                    console.error("–û—à–∏–±–∫–∞ –≤ merge: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ —Ñ–∏–≥—É—Ä—ã", player.matrix);
                    return;
                }
                
                console.log("–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ñ–∏–≥—É—Ä—ã —Å –∞—Ä–µ–Ω–æ–π –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏:", player.pos);
                
                // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Ñ–∏–≥—É—Ä—É —Å –∞—Ä–µ–Ω–æ–π
                player.matrix.forEach((row, y) => {
                    row.forEach((value, x) => {
                        if (value !== 0) {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–∑–∏—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∞—Ä–µ–Ω—ã
                            if (arena[y + player.pos.y] !== undefined && 
                                arena[y + player.pos.y][x + player.pos.x] !== undefined) {
                                arena[y + player.pos.y][x + player.pos.x] = value;
                            } else {
                                console.error("–û—à–∏–±–∫–∞ –≤ merge: –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø–∏—Å–∏ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –∞—Ä–µ–Ω—ã", 
                                             "y:", y + player.pos.y, 
                                             "x:", x + player.pos.x);
                            }
                        }
                    });
                });
                
                console.log("–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ");
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ —Ñ–∏–≥—É—Ä—ã —Å –∞—Ä–µ–Ω–æ–π:", e, "stack:", e.stack);
            }
        }
        
        function collide(arena, player) {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
                if (!arena || !player || !player.matrix || !player.pos) {
                    console.error("–û—à–∏–±–∫–∞ –≤ collide: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã", 
                                 "arena:", arena, 
                                 "player:", player);
                    return true; // –°—á–∏—Ç–∞–µ–º, —á—Ç–æ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ –µ—Å—Ç—å, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫
                }
                
                const m = player.matrix;
                const o = player.pos;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–∞—Ç—Ä–∏—Ü–∞ —Ñ–∏–≥—É—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
                if (!Array.isArray(m) || m.length === 0 || !Array.isArray(m[0])) {
                    console.error("–û—à–∏–±–∫–∞ –≤ collide: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ —Ñ–∏–≥—É—Ä—ã", m);
                    return true;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é —è—á–µ–π–∫—É —Ñ–∏–≥—É—Ä—ã
                for (let y = 0; y < m.length; ++y) {
                    for (let x = 0; x < m[y].length; ++x) {
                        // –ï—Å–ª–∏ —è—á–µ–π–∫–∞ —Ñ–∏–≥—É—Ä—ã –Ω–µ –ø—É—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ
                        if (m[y][x] !== 0) {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã—Ö–æ–¥ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –∞—Ä–µ–Ω—ã –∏–ª–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –±–ª–æ–∫–∞–º–∏
                            if (arena[y + o.y] === undefined || // –í—ã—Ö–æ–¥ –∑–∞ –Ω–∏–∂–Ω—é—é –∏–ª–∏ –≤–µ—Ä—Ö–Ω—é—é –≥—Ä–∞–Ω–∏—Ü—É
                                arena[y + o.y][x + o.x] === undefined || // –í—ã—Ö–æ–¥ –∑–∞ –±–æ–∫–æ–≤—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã
                                arena[y + o.y][x + o.x] !== 0) { // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –±–ª–æ–∫–∞–º–∏
                                
                                return true;
                            }
                        }
                    }
                }
                
                // –ï—Å–ª–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ
                return false;
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π:", e, "stack:", e.stack);
                return true; // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ –µ—Å—Ç—å
            }
        }
        
        function rotate(matrix, dir) {
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –º–∞—Ç—Ä–∏—Ü—É –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤—Ä–∞—â–µ–Ω–∏—è
            const N = matrix.length;
            const M = matrix[0].length;
            let result = [];
            
            if (dir > 0) { // –ü–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ
                for (let i = 0; i < M; i++) {
                    let newRow = [];
                    for (let j = N - 1; j >= 0; j--) {
                        newRow.push(matrix[j][i]);
                    }
                    result.push(newRow);
                }
            } else { // –ü—Ä–æ—Ç–∏–≤ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–∏
                for (let i = M - 1; i >= 0; i--) {
                    let newRow = [];
                    for (let j = 0; j < N; j++) {
                        newRow.push(matrix[j][i]);
                    }
                    result.push(newRow);
                }
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –º–∞—Ç—Ä–∏—Ü—É –≤–º–µ—Å—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–π
            const rotatedMatrix = [];
            for (let i = 0; i < result.length; i++) {
                rotatedMatrix.push([...result[i]]);
            }
            
            // –ó–∞–º–µ–Ω—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏—Å—Ö–æ–¥–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã
            matrix.length = 0; // –û—á–∏—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—É—é –º–∞—Ç—Ä–∏—Ü—É
            for (let i = 0; i < rotatedMatrix.length; i++) {
                matrix.push(rotatedMatrix[i]);
            }
        }
        
        function playerRotate(dir) {
            const originalPos = {
                x: player.pos.x,
                y: player.pos.y
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –º–∞—Ç—Ä–∏—Ü—É
            const originalMatrix = JSON.parse(JSON.stringify(player.matrix));
            
            // –í—Ä–∞—â–∞–µ–º –º–∞—Ç—Ä–∏—Ü—É
            rotate(player.matrix, dir);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –ª–∏ —Ñ–∏–≥—É—Ä–∞ –∑–∞ –ø—Ä–∞–≤—É—é –≥—Ä–∞–Ω–∏—Ü—É
            const rightOverhang = player.pos.x + player.matrix[0].length - COLS;
            if (rightOverhang > 0) {
                player.pos.x -= rightOverhang;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –ª–∏ —Ñ–∏–≥—É—Ä–∞ –∑–∞ –ª–µ–≤—É—é –≥—Ä–∞–Ω–∏—Ü—É
            if (player.pos.x < 0) {
                player.pos.x = 0;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –ª–∏ —Ñ–∏–≥—É—Ä–∞ –∑–∞ –Ω–∏–∂–Ω—é—é –≥—Ä–∞–Ω–∏—Ü—É
            const bottomOverhang = player.pos.y + player.matrix.length - ROWS;
            if (bottomOverhang > 0) {
                player.pos.y -= bottomOverhang;
            }
            
            // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –ø–æ–∑–∏—Ü–∏—é, –≥–¥–µ —Ñ–∏–≥—É—Ä–∞ –Ω–µ –±—É–¥–µ—Ç —Å—Ç–∞–ª–∫–∏–≤–∞—Ç—å—Å—è
            let offset = 1;
            let attempts = 0;
            const maxAttempts = Math.max(player.matrix[0].length, player.matrix.length) * 2;
            
            while (collide(arena, player)) {
                player.pos.x += offset;
                offset = -(offset + (offset > 0 ? 1 : -1));
                attempts++;
                
                // –ï—Å–ª–∏ –Ω–µ –º–æ–∂–µ–º —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Ñ–∏–≥—É—Ä—É –ø–æ—Å–ª–µ –≤—Ä–∞—â–µ–Ω–∏—è –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏,
                // –ø—Ä–æ–±—É–µ–º —Å–¥–≤–∏–Ω—É—Ç—å –≤–≤–µ—Ä—Ö
                if (Math.abs(offset) > player.matrix[0].length) {
                    player.pos.x = originalPos.x;
                    player.pos.y--;
                    offset = 1;
                }
                
                // –ï—Å–ª–∏ –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ —É–¥–∞–ª–∏—Å—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—É—é —Ñ–∏–≥—É—Ä—É
                if (attempts > maxAttempts) {
                    player.matrix = originalMatrix;
                    player.pos.x = originalPos.x;
                    player.pos.y = originalPos.y;
                    return;
                }
            }
        }
        
        function playerDrop() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
                if (gameOver || paused) {
                    console.log("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞ –∏–ª–∏ –Ω–∞ –ø–∞—É–∑–µ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º playerDrop");
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ player –∏ –µ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
                if (!player || !player.pos || !player.matrix) {
                    console.error("–û—à–∏–±–∫–∞: player –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω", player);
                    return;
                }
                
                // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ñ–∏–≥—É—Ä—É –≤–Ω–∏–∑
                player.pos.y++;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ
                if (collide(arena, player)) {
                    console.log("–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏");
                    
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–∏–≥—É—Ä—É –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –ø–æ–∑–∏—Ü–∏—é
                    player.pos.y--;
                    
                    // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Ñ–∏–≥—É—Ä—É —Å –∞—Ä–µ–Ω–æ–π
                    merge(arena, player);
                    
                    // –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ª–∏–Ω–∏–π —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Ñ–∏–≥—É—Ä—É
                    arenaSweep(() => {
                        const ended = playerReset();
                        if (!ended) {
                            updateScore();
                        }
                    });
                }
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–∞–¥–µ–Ω–∏—è
                dropCounter = 0;
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –≤ playerDrop:", e, "stack:", e.stack);
                dropCounter = 0;
            }
        }
        
        function playerMove(offset) {
            player.pos.x += offset;
            if (collide(arena, player)) {
                player.pos.x -= offset;
            }
        }
        
        function playerHardDrop() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
                if (gameOver || paused) {
                    console.log("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞ –∏–ª–∏ –Ω–∞ –ø–∞—É–∑–µ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º playerHardDrop");
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ player –∏ –µ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
                if (!player || !player.pos || !player.matrix) {
                    console.error("–û—à–∏–±–∫–∞: player –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω", player);
                    return;
                }
                
                console.log("–í—ã–ø–æ–ª–Ω—è–µ–º –±—ã—Å—Ç—Ä–æ–µ –ø–∞–¥–µ–Ω–∏–µ");
                
                // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ñ–∏–≥—É—Ä—É –≤–Ω–∏–∑ –¥–æ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
                let dropDistance = 0;
                while (!collide(arena, player)) {
                    player.pos.y++;
                    dropDistance++;
                    
                    // –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
                    if (dropDistance > 100) {
                        console.error("–û–±–Ω–∞—Ä—É–∂–µ–Ω –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –≤ playerHardDrop");
                        break;
                    }
                }
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–∏–≥—É—Ä—É –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–∞–ª–∏–¥–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
                player.pos.y--;
                
                // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Ñ–∏–≥—É—Ä—É —Å –∞—Ä–µ–Ω–æ–π
                merge(arena, player);
                
                arenaSweep(() => {
                    const ended = playerReset();
                    if (!ended) {
                        updateScore();
                    }
                });

                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–∞–¥–µ–Ω–∏—è
                dropCounter = 0;
                
                console.log("–ë—ã—Å—Ç—Ä–æ–µ –ø–∞–¥–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –ø—Ä–æ–π–¥–µ–Ω–æ –∫–ª–µ—Ç–æ–∫:", dropDistance);
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –≤ playerHardDrop:", e, "stack:", e.stack);
                dropCounter = 0;
            }
        }
        
        function playerReset() {
            try {
                console.log("–í—ã–∑–æ–≤ playerReset...");
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ player –æ–ø—Ä–µ–¥–µ–ª–µ–Ω
                if (!player) {
                    console.error("–û—à–∏–±–∫–∞: player –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω");
                    player = {
                        pos: {
                            x: 0,
                            y: 0
                        },
                        matrix: null,
                        next: null,
                        score: 0
                    };
                }
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é —Ñ–∏–≥—É—Ä—É –∫–∞–∫ —Ç–µ–∫—É—â—É—é
                if (!player.next) {
                    console.log("–°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Ç–µ–∫—É—â—É—é —Ñ–∏–≥—É—Ä—É");
                    const pieceIndex = Math.floor(Math.random() * pieces.length);
                    player.matrix = createPiece(pieceIndex);
                    console.log("–°–æ–∑–¥–∞–Ω–∞ —Ñ–∏–≥—É—Ä–∞ —Å –∏–Ω–¥–µ–∫—Å–æ–º:", pieceIndex);
                } else {
                    console.log("–ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ª–µ–¥—É—é—â—É—é —Ñ–∏–≥—É—Ä—É –∫–∞–∫ —Ç–µ–∫—É—â—É—é");
                    player.matrix = player.next;
                }
                
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å–ª–µ–¥—É—é—â—É—é —Ñ–∏–≥—É—Ä—É
                const nextPieceIndex = Math.floor(Math.random() * pieces.length);
                player.next = createPiece(nextPieceIndex);
                console.log("–°–æ–∑–¥–∞–Ω–∞ —Å–ª–µ–¥—É—é—â–∞—è —Ñ–∏–≥—É—Ä–∞ —Å –∏–Ω–¥–µ–∫—Å–æ–º:", nextPieceIndex);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–∞—Ç—Ä–∏—Ü–∞ —Ñ–∏–≥—É—Ä—ã —Å–æ–∑–¥–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
                if (!player.matrix || !Array.isArray(player.matrix) || player.matrix.length === 0) {
                    console.error("–û—à–∏–±–∫–∞: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ —Ñ–∏–≥—É—Ä—ã", player.matrix);
                    player.matrix = createPiece(0); // –°–æ–∑–¥–∞–µ–º —Ñ–∏–≥—É—Ä—É T –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                }
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
                player.pos.y = 0;
                player.pos.x = Math.floor((arena[0].length - player.matrix[0].length) / 2);
                console.log("–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è:", player.pos);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–Ω–µ—Ü –∏–≥—Ä—ã
                if (collide(arena, player)) {
                    console.log("–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –∏–≥—Ä–æ–∫–∞ - GAME OVER");
                    
                    // –û—á–∏—â–∞–µ–º –∞—Ä–µ–Ω—É
                    for (let i = 0; i < arena.length; i++) {
                        for (let j = 0; j < arena[i].length; j++) {
                            arena[i][j] = 0;
                        }
                    }
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç
                    player.score = 0;
                    score = 0;
                    lines = 0;
                    level = 1;
                    updateScore();
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã
                    gameOver = true;
                    paused = false;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                    if (startButton) {
                        startButton.textContent = '‚ñ∂Ô∏è –°–¢–ê–†–¢';
                    }
                    
                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
                    if (animationId !== null) {
                        cancelAnimationFrame(animationId);
                        animationId = null;
                    }
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∫–æ–Ω—Ü–µ –∏–≥—Ä—ã
                    if (context) {
                        context.fillStyle = 'rgba(0, 0, 0, 0.7)';
                        context.fillRect(0, 0, canvas.width, canvas.height);
                        
                        context.font = '30px Arial';
                        context.fillStyle = 'white';
                        context.textAlign = 'center';
                        context.fillText('–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê', canvas.width / 2, canvas.height / 2 - 30);
                        context.fillText('–ù–∞–∂–º–∏—Ç–µ –°–¢–ê–†–¢ –¥–ª—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã', canvas.width / 2, canvas.height / 2 + 30);
                    }
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
                    if (animationId === null) {
                        animationId = requestAnimationFrame(update);
                    }
                    
                    console.log("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞, —ç–∫—Ä–∞–Ω –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω");
                    return true; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º true, –µ—Å–ª–∏ –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞
                }
                
                console.log("playerReset –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ");
                return false; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º false, –µ—Å–ª–∏ –∏–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –≤ playerReset:", e, "stack:", e.stack);
                gameOver = true;
                paused = false;
                startButton.textContent = '‚ñ∂Ô∏è –°–¢–ê–†–¢';
                return true;
            }
        }
        
        function arenaSweep(callback = () => {}) {
            let rowCount = 0;
            let rowsToRemove = [];
            
            // –ù–∞—Ö–æ–¥–∏–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
            for (let y = arena.length - 1; y >= 0; --y) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞
                if (arena[y] && arena[y].every(value => value !== 0)) {
                    rowsToRemove.push(y);
                    rowCount++;
                }
            }
            
            if (rowCount > 0) {
                // –ê–Ω–∏–º–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫
                animateRowClear(rowsToRemove, () => {
                    try {
                        // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏ –≤ –ø–æ—Ä—è–¥–∫–µ —É–±—ã–≤–∞–Ω–∏—è
                        rowsToRemove.sort((a, b) => b - a);
                        
                        // –£–¥–∞–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏
                        rowsToRemove.forEach(y => {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–Ω–¥–µ–∫—Å —Å—Ç—Ä–æ–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
                            if (y >= 0 && y < arena.length) {
                                arena.splice(y, 1);
                                arena.unshift(new Array(COLS).fill(0));
                            }
                        });
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç
                        player.score += rowCount * 10 * level;
                        lines += rowCount;
                        level = Math.floor(lines / 10) + 1;
                        dropInterval = 1000 / level;
                        
                        updateScore();
                        callback();
                    } catch (e) {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫:", e);
                    }
                });
            } else {
                callback();
            }
        }
        
        function animateRowClear(rows, callback) {
            try {
                let animationStep = 0;
                const totalSteps = 6;
                
                function animate() {
                    try {
                        if (animationStep >= totalSteps) {
                            callback();
                            return;
                        }
                        
                        // –ü—Ä–æ—Å—Ç–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –º–∏–≥–∞–Ω–∏—è —Å—Ç—Ä–æ–∫
                        rows.forEach((y) => {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–Ω–¥–µ–∫—Å —Å—Ç—Ä–æ–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
                            if (y >= 0 && y < arena.length) {
                                // –ß–µ—Ä–µ–¥—É–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Å—Ç—Ä–æ–∫ (–º–∏–≥–∞–Ω–∏–µ)
                                if (animationStep % 2 === 0) {
                                    // –î–µ–ª–∞–µ–º —Å—Ç—Ä–æ–∫—É –ø—É—Å—Ç–æ–π (–Ω–µ–≤–∏–¥–∏–º–æ–π)
                                    arena[y].fill(0);
                                } else {
                                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä–æ–∫—É (–∑–∞–ø–æ–ª–Ω—è–µ–º –µ–¥–∏–Ω–∏—Ü–∞–º–∏ –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏)
                                    arena[y].fill(1);
                                }
                            }
                        });
                        
                        // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –∫–∞–¥—Ä
                        draw();
                        
                        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É –∞–Ω–∏–º–∞—Ü–∏–∏
                        animationStep++;
                        setTimeout(animate, 100);
                    } catch (e) {
                        console.error("–û—à–∏–±–∫–∞ –≤ —à–∞–≥–µ –∞–Ω–∏–º–∞—Ü–∏–∏:", e);
                        callback(); // –í—ã–∑—ã–≤–∞–µ–º callback –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏, —á—Ç–æ–±—ã –∏–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∞—Å—å
                    }
                }
                
                animate();
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∞–Ω–∏–º–∞—Ü–∏–∏:", e);
                callback(); // –í—ã–∑—ã–≤–∞–µ–º callback –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏, —á—Ç–æ–±—ã –∏–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∞—Å—å
            }
        }
        
        function updateScore() {
            document.getElementById('score').textContent = player.score;
            document.getElementById('lines').textContent = lines;
            document.getElementById('level').textContent = level;
        }
        
        function togglePause() {
            paused = !paused;
            if (paused) {
                startButton.textContent = '‚ñ∂Ô∏è –ü–†–û–î–û–õ–ñ–ò–¢–¨';
            } else {
                startButton.textContent = '‚è∏Ô∏è –ü–ê–£–ó–ê';
            }
        }
        
        let animationId = null;
        
        function update(time = 0) {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ canvas –∏ context –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
                if (!canvas || !context) {
                    console.error("–û—à–∏–±–∫–∞: canvas –∏–ª–∏ context –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ update");
                    
                    // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å canvas –∏ context –∑–∞–Ω–æ–≤–æ
                    canvas = document.getElementById('tetris');
                    context = canvas.getContext('2d');
                    
                    if (!canvas || !context) {
                        console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å canvas –∏–ª–∏ context –≤ update");
                        
                        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
                        if (animationId) {
                            cancelAnimationFrame(animationId);
                            animationId = null;
                        }
                        
                        return;
                    }
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π animationId –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                const currentAnimationId = animationId;
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º deltaTime
                const deltaTime = time - lastTime;
                lastTime = time;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ deltaTime –∏–º–µ–µ—Ç —Ä–∞–∑—É–º–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                if (deltaTime > 1000) {
                    console.log("–ë–æ–ª—å—à–æ–π deltaTime:", deltaTime, "–º—Å, –≤–æ–∑–º–æ–∂–Ω–æ, –≤–∫–ª–∞–¥–∫–∞ –±—ã–ª–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞");
                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º deltaTime, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–æ–ª—å—à–∏—Ö —Å–∫–∞—á–∫–æ–≤
                    lastTime = time;
                    dropCounter = 0;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–≥—Ä–æ–≤—É—é –ª–æ–≥–∏–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–≥—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞
                if (!gameOver && !paused) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ player –∏ –µ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
                    if (!player || !player.pos || !player.matrix) {
                        console.error("–û—à–∏–±–∫–∞: player –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω –≤ update", player);
                        
                        // –ü—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å player
                        if (!player) {
                            player = {
                                pos: {
                                    x: 0,
                                    y: 0
                                },
                                matrix: null,
                                next: null,
                                score: 0
                            };
                        }
                        
                        // –ü—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ñ–∏–≥—É—Ä—É
                        if (!player.matrix) {
                            player.matrix = createPiece(Math.floor(Math.random() * pieces.length));
                        }
                        
                        // –ü—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é —Ñ–∏–≥—É—Ä—É
                        if (!player.next) {
                            player.next = createPiece(Math.floor(Math.random() * pieces.length));
                        }
                        
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
                        player.pos.y = 0;
                        player.pos.x = Math.floor((arena[0].length - player.matrix[0].length) / 2);
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–∞–¥–µ–Ω–∏—è
                    dropCounter += deltaTime;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ—Ä–∞ –ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–≥—É—Ä—É
                    if (dropCounter > dropInterval) {
                        playerDrop();
                    }
                }
                
                // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                draw();
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∫–∞–¥—Ä
                if (animationId !== null) {
                    // –ï—Å–ª–∏ –∏–≥—Ä–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏–ª–∏ –Ω–∞ –ø–∞—É–∑–µ, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∫–∞–¥—Ä
                    if (!gameOver || paused) {
                        animationId = requestAnimationFrame(update);
                    } else {
                        // –ï—Å–ª–∏ –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                        draw();
                    }
                } else {
                    console.log("animationId —Ä–∞–≤–µ–Ω null, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–æ–≤—ã–π –∫–∞–¥—Ä");
                    animationId = requestAnimationFrame(update);
                }
                
                // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
                if (time % 3000 < 20) { // –õ–æ–≥–∏—Ä—É–µ–º –ø—Ä–∏–º–µ—Ä–Ω–æ —Ä–∞–∑ –≤ 3 —Å–µ–∫—É–Ω–¥—ã
                    console.log("–ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç–∞–µ—Ç, gameOver:", gameOver, "paused:", paused, 
                                "animationId:", animationId, "–ø—Ä–µ–¥—ã–¥—É—â–∏–π:", currentAnimationId);
                }
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –≤ –∏–≥—Ä–æ–≤–æ–º —Ü–∏–∫–ª–µ:", e, "stack:", e.stack);
                
                // –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–æ–≤—ã–π –∫–∞–¥—Ä —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
                setTimeout(() => {
                    console.log("–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏");
                    animationId = requestAnimationFrame(update);
                }, 1000);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            try {
                console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã...");
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –∑–∞–ø—É—â–µ–Ω
                if (animationId !== null) {
                    console.log("–û—Ç–º–µ–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π animationFrame:", animationId);
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ canvas –∏ context –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
                if (!canvas || !context) {
                    console.error("–û—à–∏–±–∫–∞: canvas –∏–ª–∏ context –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã");
                    
                    // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å canvas –∏ context –∑–∞–Ω–æ–≤–æ
                    canvas = document.getElementById('tetris');
                    context = canvas.getContext('2d');
                    
                    if (!canvas || !context) {
                        console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å canvas –∏–ª–∏ context");
                        return false;
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ nextCanvas –∏ nextContext –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
                if (!nextCanvas || !nextContext) {
                    console.error("–û—à–∏–±–∫–∞: nextCanvas –∏–ª–∏ nextContext –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã");
                    
                    // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å nextCanvas –∏ nextContext –∑–∞–Ω–æ–≤–æ
                    nextCanvas = document.getElementById('next');
                    nextContext = nextCanvas.getContext('2d');
                    
                    if (!nextCanvas || !nextContext) {
                        console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å nextCanvas –∏–ª–∏ nextContext");
                        return false;
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ startButton –æ–ø—Ä–µ–¥–µ–ª–µ–Ω
                if (!startButton) {
                    console.error("–û—à–∏–±–∫–∞: startButton –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω");
                    
                    // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å startButton –∑–∞–Ω–æ–≤–æ
                    startButton = document.getElementById('startButton');
                    
                    if (!startButton) {
                        console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å startButton");
                        return false;
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ arena –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
                if (!arena || !Array.isArray(arena) || arena.length === 0) {
                    console.error("–û—à–∏–±–∫–∞: arena –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞");
                    
                    // –°–æ–∑–¥–∞–µ–º –∞—Ä–µ–Ω—É –∑–∞–Ω–æ–≤–æ
                    arena = createMatrix(COLS, ROWS);
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ player –æ–ø—Ä–µ–¥–µ–ª–µ–Ω
                if (!player) {
                    console.error("–û—à–∏–±–∫–∞: player –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω");
                    
                    // –°–æ–∑–¥–∞–µ–º player –∑–∞–Ω–æ–≤–æ
                    player = {
                        pos: {
                            x: 0,
                            y: 0
                        },
                        matrix: null,
                        next: null,
                        score: 0
                    };
                }
                
                // –û—á–∏—â–∞–µ–º –∞—Ä–µ–Ω—É
                for (let i = 0; i < arena.length; i++) {
                    for (let j = 0; j < arena[i].length; j++) {
                        arena[i][j] = 0;
                    }
                }
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç
                player.score = 0;
                score = 0;
                lines = 0;
                level = 1;
                
                // –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤—É—é —Ñ–∏–≥—É—Ä—É –∏ —Å–ª–µ–¥—É—é—â—É—é —Ñ–∏–≥—É—Ä—É
                const firstPieceIndex = Math.floor(Math.random() * pieces.length);
                player.matrix = createPiece(firstPieceIndex);
                console.log("–°–æ–∑–¥–∞–Ω–∞ –ø–µ—Ä–≤–∞—è —Ñ–∏–≥—É—Ä–∞ —Å –∏–Ω–¥–µ–∫—Å–æ–º:", firstPieceIndex);
                
                const nextPieceIndex = Math.floor(Math.random() * pieces.length);
                player.next = createPiece(nextPieceIndex);
                console.log("–°–æ–∑–¥–∞–Ω–∞ —Å–ª–µ–¥—É—é—â–∞—è —Ñ–∏–≥—É—Ä–∞ —Å –∏–Ω–¥–µ–∫—Å–æ–º:", nextPieceIndex);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–∞—Ç—Ä–∏—Ü—ã —Ñ–∏–≥—É—Ä —Å–æ–∑–¥–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
                if (!player.matrix || !Array.isArray(player.matrix) || player.matrix.length === 0) {
                    console.error("–û—à–∏–±–∫–∞: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ —Ç–µ–∫—É—â–µ–π —Ñ–∏–≥—É—Ä—ã", player.matrix);
                    player.matrix = createPiece(0); // –°–æ–∑–¥–∞–µ–º —Ñ–∏–≥—É—Ä—É T –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                }
                
                if (!player.next || !Array.isArray(player.next) || player.next.length === 0) {
                    console.error("–û—à–∏–±–∫–∞: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∏–≥—É—Ä—ã", player.next);
                    player.next = createPiece(0); // –°–æ–∑–¥–∞–µ–º —Ñ–∏–≥—É—Ä—É T –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                }
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
                player.pos.y = 0;
                player.pos.x = Math.floor((arena[0].length - player.matrix[0].length) / 2);
                console.log("–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è:", player.pos);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç
                updateScore();
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥–∏
                gameOver = false;
                paused = false;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                if (startButton) {
                    startButton.textContent = '‚è∏Ô∏è –ü–ê–£–ó–ê';
                }
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–∞–¥–µ–Ω–∏—è
                dropCounter = 0;
                lastTime = 0;
                
                // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                draw();
                
                console.log("–ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞");
                return true;
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã:", e, "stack:", e.stack);
                return false;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã
        function startGame() {
            try {
                console.log("–ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã, —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: gameOver=" + gameOver + ", paused=" + paused + ", animationId=" + animationId);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ startButton –æ–ø—Ä–µ–¥–µ–ª–µ–Ω
                if (!startButton) {
                    console.error("–û—à–∏–±–∫–∞: startButton –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω");
                    
                    // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å startButton –∑–∞–Ω–æ–≤–æ
                    startButton = document.getElementById('startButton');
                    
                    if (!startButton) {
                        console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å startButton");
                        return;
                    }
                }
                
                if (gameOver || animationId === null) {
                    console.log("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞ –∏–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–∞–Ω–æ–≤–æ");
                    
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É –∑–∞–Ω–æ–≤–æ
                    const initSuccess = initGame();
                    
                    if (!initSuccess) {
                        console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä—É");
                        
                        // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
                        setTimeout(() => {
                            console.log("–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã");
                            const retrySuccess = initGame();
                            
                            if (retrySuccess) {
                                console.log("–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª");
                                lastTime = 0;
                                dropCounter = 0;
                                
                                // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π —Ü–∏–∫–ª
                                if (animationId !== null) {
                                    cancelAnimationFrame(animationId);
                                }
                                
                                animationId = requestAnimationFrame(update);
                                console.log("–ù–æ–≤—ã–π animationId:", animationId);
                            } else {
                                console.error("–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å");
                                
                                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                                if (context) {
                                    context.fillStyle = 'rgba(0, 0, 0, 0.7)';
                                    context.fillRect(0, 0, canvas.width, canvas.height);
                                    
                                    context.font = '20px Arial';
                                    context.fillStyle = 'white';
                                    context.textAlign = 'center';
                                    context.fillText('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã', canvas.width / 2, canvas.height / 2 - 30);
                                    context.fillText('–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É', canvas.width / 2, canvas.height / 2 + 30);
                                }
                            }
                        }, 500);
                        
                        return;
                    }
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
                    console.log("–ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª");
                    lastTime = 0;
                    dropCounter = 0;
                    
                    // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ü–∏–∫–ª –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
                    if (animationId !== null) {
                        cancelAnimationFrame(animationId);
                    }
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π —Ü–∏–∫–ª
                    animationId = requestAnimationFrame(update);
                    console.log("–ù–æ–≤—ã–π animationId:", animationId);
                } else if (paused) {
                    console.log("–ò–≥—Ä–∞ –Ω–∞ –ø–∞—É–∑–µ, —Å–Ω–∏–º–∞–µ–º —Å –ø–∞—É–∑—ã");
                    
                    // –°–Ω–∏–º–∞–µ–º —Å –ø–∞—É–∑—ã
                    paused = false;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                    if (startButton) {
                        startButton.textContent = '‚è∏Ô∏è –ü–ê–£–ó–ê';
                    }
                    
                    // –ï—Å–ª–∏ –∞–Ω–∏–º–∞—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –µ—ë
                    if (animationId === null) {
                        console.log("–ê–Ω–∏–º–∞—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –∑–∞–Ω–æ–≤–æ");
                        lastTime = 0;
                        animationId = requestAnimationFrame(update);
                        console.log("–í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é, –Ω–æ–≤—ã–π animationId:", animationId);
                    }
                } else {
                    console.log("–ò–≥—Ä–∞ —É–∂–µ –∑–∞–ø—É—â–µ–Ω–∞, —Å—Ç–∞–≤–∏–º –Ω–∞ –ø–∞—É–∑—É");
                    
                    // –°—Ç–∞–≤–∏–º –Ω–∞ –ø–∞—É–∑—É
                    paused = true;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                    if (startButton) {
                        startButton.textContent = '‚ñ∂Ô∏è –ü–†–û–î–û–õ–ñ–ò–¢–¨';
                    }
                }
                
                console.log("–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞: gameOver=" + gameOver + ", paused=" + paused + ", animationId=" + animationId);
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏–≥—Ä—ã:", e, "stack:", e.stack);
                
                // –ê–≤–∞—Ä–∏–π–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
                gameOver = true;
                paused = false;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                if (startButton) {
                    startButton.textContent = '‚ñ∂Ô∏è –°–¢–ê–†–¢';
                }
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                if (context) {
                    context.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    context.fillRect(0, 0, canvas.width, canvas.height);
                    
                    context.font = '20px Arial';
                    context.fillStyle = 'white';
                    context.textAlign = 'center';
                    context.fillText('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞', canvas.width / 2, canvas.height / 2 - 30);
                    context.fillText('–ù–∞–∂–º–∏—Ç–µ –°–¢–ê–†–¢ –¥–ª—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã', canvas.width / 2, canvas.height / 2 + 30);
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        document.addEventListener('keydown', event => {
            if (gameOver) return;
            
            switch (event.keyCode) {
                case 37: // –°—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ
                    playerMove(-1);
                    break;
                case 39: // –°—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ
                    playerMove(1);
                    break;
                case 40: // –°—Ç—Ä–µ–ª–∫–∞ –≤–Ω–∏–∑
                    playerDrop();
                    break;
                case 38: // –°—Ç—Ä–µ–ª–∫–∞ –≤–≤–µ—Ä—Ö
                    playerRotate(1);
                    break;
                case 32: // –ü—Ä–æ–±–µ–ª
                    event.preventDefault();
                    playerHardDrop();
                    break;
                case 80: // –ö–ª–∞–≤–∏—à–∞ 'P'
                    togglePause();
                    break;
            }
        });
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–≤–∞–π–ø–æ–≤ –∏ —Ç–∞–ø–æ–≤
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;
        let lastTapTime = 0;
        
        // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤–∞–π–ø–∞
        const minSwipeDistance = 30;
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã
        canvas.addEventListener('dblclick', function(event) {
            if (gameOver) {
                startGame();
            } else {
                togglePause();
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–µ–Ω—Å–æ—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Å–≤–∞–π–ø–æ–≤
        canvas.addEventListener('touchstart', function(event) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞—á–∞–ª–∞ –∫–∞—Å–∞–Ω–∏—è
            touchStartX = event.changedTouches[0].screenX;
            touchStartY = event.changedTouches[0].screenY;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–≤–æ–π–Ω–æ–≥–æ —Ç–∞–ø–∞
            const now = new Date().getTime();
            const timeSince = now - lastTapTime;
            
            if (timeSince < 300 && timeSince > 0) {
                // –î–≤–æ–π–Ω–æ–π —Ç–∞–ø –æ–±–Ω–∞—Ä—É–∂–µ–Ω
                if (gameOver) {
                    startGame();
                } else {
                    togglePause();
                }
                event.preventDefault();
            }
            
            lastTapTime = now;
        });
        
        canvas.addEventListener('touchmove', function(event) {
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–≤–∏–∂–µ–Ω–∏–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ
            const touchX = event.changedTouches[0].screenX;
            const touchY = event.changedTouches[0].screenY;
            const deltaX = Math.abs(touchX - touchStartX);
            const deltaY = Math.abs(touchY - touchStartY);
            
            // –ï—Å–ª–∏ –¥–≤–∏–∂–µ–Ω–∏–µ –±–æ–ª—å—à–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ, —á–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ
            if (deltaX > deltaY && deltaX > 10) {
                event.preventDefault();
            }
        }, { passive: false });
        
        canvas.addEventListener('touchend', function(event) {
            if (gameOver || paused) return;
            
            touchEndX = event.changedTouches[0].screenX;
            touchEndY = event.changedTouches[0].screenY;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –±—ã–ª –ª–∏ —ç—Ç–æ —Å–≤–∞–π–ø –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Ç–∞–ø
            const deltaX = Math.abs(touchEndX - touchStartX);
            const deltaY = Math.abs(touchEndY - touchStartY);
            
            // –ï—Å–ª–∏ –±—ã–ª–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ —Å–≤–∞–π–ø
            if (deltaX > 10 || deltaY > 10) {
                handleSwipe();
                event.preventDefault();
            }
        }, { passive: false });
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–≤–∞–π–ø–∞
        function handleSwipe() {
            try {
                const deltaX = touchEndX - touchStartX;
                const deltaY = touchEndY - touchStartY;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –±—ã–ª –ª–∏ —Å–≤–∞–π–ø –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª–∏–Ω–Ω—ã–º
                if (Math.abs(deltaX) > minSwipeDistance || Math.abs(deltaY) > minSwipeDistance) {
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∞–π–ø–∞
                    if (Math.abs(deltaX) > Math.abs(deltaY)) {
                        // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
                        if (deltaX > 0) {
                            // –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ - –ø–µ—Ä–µ–º–µ—â–∞–µ–º –Ω–∞ 1 –∫–ª–µ—Ç–∫—É –∑–∞ —Ä–∞–∑, –Ω–æ –±—ã—Å—Ç—Ä–µ–µ
                            for (let i = 0; i < 3; i++) {
                                playerMove(1);
                            }
                        } else {
                            // –°–≤–∞–π–ø –≤–ª–µ–≤–æ - –ø–µ—Ä–µ–º–µ—â–∞–µ–º –Ω–∞ 1 –∫–ª–µ—Ç–∫—É –∑–∞ —Ä–∞–∑, –Ω–æ –±—ã—Å—Ç—Ä–µ–µ
                            for (let i = 0; i < 3; i++) {
                                playerMove(-1);
                            }
                        }
                    } else {
                        // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
                        if (deltaY > 0) {
                            // –°–≤–∞–π–ø –≤–Ω–∏–∑
                            playerHardDrop(); // –ë—ã—Å—Ç—Ä–æ–µ –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–∏ —Å–≤–∞–π–ø–µ –≤–Ω–∏–∑
                        } else {
                            // –°–≤–∞–π–ø –≤–≤–µ—Ä—Ö
                            playerRotate(1); // –í—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–∏ —Å–≤–∞–π–ø–µ –≤–≤–µ—Ä—Ö
                        }
                    }
                }
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–≤–∞–π–ø–∞:", e);
            }
        }
        
        startButton.addEventListener('click', () => {
            if (gameOver) {
                startGame();
            } else {
                togglePause();
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º touchstart –≤–º–µ—Å—Ç–æ click –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞
        
        const leftBtn = document.getElementById('left-btn');
        leftBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (!gameOver && !paused) playerMove(-1);
        }, { passive: false });
        
        const rightBtn = document.getElementById('right-btn');
        rightBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (!gameOver && !paused) playerMove(1);
        }, { passive: false });
        
        const downBtn = document.getElementById('down-btn');
        downBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (!gameOver && !paused) playerDrop();
        }, { passive: false });
        
        const rotateBtn = document.getElementById('rotate-btn');
        rotateBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (!gameOver && !paused) playerRotate(1);
        }, { passive: false });
        
        const dropBtn = document.getElementById('drop-btn');
        dropBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (!gameOver && !paused) playerHardDrop();
        }, { passive: false });
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–∫–∂–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ click –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        leftBtn.addEventListener('click', () => {
            if (!gameOver && !paused) playerMove(-1);
        });
        
        rightBtn.addEventListener('click', () => {
            if (!gameOver && !paused) playerMove(1);
        });
        
        downBtn.addEventListener('click', () => {
            if (!gameOver && !paused) playerDrop();
        });
        
        rotateBtn.addEventListener('click', () => {
            if (!gameOver && !paused) playerRotate(1);
        });
        
        dropBtn.addEventListener('click', () => {
            if (!gameOver && !paused) playerHardDrop();
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ä—Ç–∞/–ø–∞—É–∑—ã
        const startButton = document.getElementById('start-button');
        startButton.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (gameOver) {
                startGame();
            } else {
                togglePause();
            }
        }, { passive: false });
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–∫–∂–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ click –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        startButton.addEventListener('click', () => {
            if (gameOver) {
                startGame();
            } else {
                togglePause();
            }
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏
        document.querySelectorAll('.mobile-controls button').forEach(button => {
            button.addEventListener('touchmove', e => e.preventDefault());
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–µ—Å—Ç–∫–∏ –Ω–∞ —Ñ–æ–Ω
        function createSparkles() {
            const container = document.querySelector('.game-container');
            for (let i = 0; i < 30; i++) {
                const sparkle = document.createElement('div');
                sparkle.classList.add('sparkle');
                sparkle.style.left = `${Math.random() * 100}%`;
                sparkle.style.top = `${Math.random() * 100}%`;
                sparkle.style.animationDelay = `${Math.random() * 2}s`;
                container.appendChild(sparkle);
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ö–æ–ª—Å—Ç–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∏–≥—É—Ä—ã
        nextCanvas.style.width = `${120}px`;
        nextCanvas.style.height = `${120}px`;
        
        // –°–æ–∑–¥–∞–µ–º –±–ª–µ—Å—Ç–∫–∏
        createSparkles();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è...");
        
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –∑–∞–ø—É—â–µ–Ω
        if (animationId !== null) {
            cancelAnimationFrame(animationId);
            animationId = null;
        }
        
        // –û—á–∏—â–∞–µ–º –∞—Ä–µ–Ω—É
        arena.forEach(row => row.fill(0));
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç
        player.score = 0;
        score = 0;
        lines = 0;
        level = 1;
        updateScore();
        
        // –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤—É—é —Ñ–∏–≥—É—Ä—É –∏ —Å–ª–µ–¥—É—é—â—É—é —Ñ–∏–≥—É—Ä—É
        player.matrix = createPiece(Math.floor(Math.random() * pieces.length));
        player.next = createPiece(Math.floor(Math.random() * pieces.length));
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
        player.pos.y = 0;
        player.pos.x = Math.floor((arena[0].length - player.matrix[0].length) / 2);
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã - –∏–≥—Ä–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞
        gameOver = true;
        paused = false;
        startButton.textContent = '‚ñ∂Ô∏è –°–¢–ê–†–¢';
        
        // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        draw();
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        lastTime = 0;
        animationId = requestAnimationFrame(update);
        
        console.log("–ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ");
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
            setTimeout(startGame, 1000);
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –ø–æ—Å–ª–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
            const scrollIndicator = document.getElementById('scroll-indicator');
            if (scrollIndicator) {
                window.addEventListener('scroll', function() {
                    if (window.scrollY > 50) {
                        scrollIndicator.style.opacity = '0';
                        setTimeout(() => {
                            scrollIndicator.style.display = 'none';
                        }, 500);
                    }
                });
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
                setTimeout(() => {
                    scrollIndicator.style.opacity = '0';
                    setTimeout(() => {
                        scrollIndicator.style.display = 'none';
                    }, 500);
                }, 5000);
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É...");
            
            // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            draw();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π, —á—Ç–æ–±—ã –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É—Å–ø–µ–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
            setTimeout(function() {
                console.log("–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã...");
                // –ï—Å–ª–∏ –∏–≥—Ä–∞ –µ—â–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –µ—ë
                if (gameOver || !animationId) {
                    startGame();
                }
            }, 500);
        });
    </script>
</body>
</html>