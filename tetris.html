<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Ç—Ä–∏—Å</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body {
            background: linear-gradient(135deg, #6e45e2, #88d3ce);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            color: white;
            overflow: hidden;
        }
        
        .game-container {
            display: flex;
            flex-direction: row;
            gap: 20px;
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 900px;
            width: 100%;
        }
        
        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 200px;
        }
        
        .score-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        h1 {
            font-size: 2em;
            margin: 0 0 20px 0;
            text-align: center;
            animation: pulse 2s infinite;
        }
        
        canvas {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            image-rendering: pixelated;
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            border: none;
            padding: 12px 20px;
            font-size: 1.2em;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            font-weight: bold;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .controls-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        .controls-info h3 {
            margin-top: 0;
            text-align: center;
        }
        
        .controls-info p {
            margin: 8px 0;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .sparkle {
            position: absolute;
            width: 5px;
            height: 5px;
            background: white;
            border-radius: 50%;
            animation: sparkle 1s infinite;
        }
        
        @keyframes sparkle {
            0% { opacity: 0.2; }
            50% { opacity: 1; }
            100% { opacity: 0.2; }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
                height: auto;
                min-height: 100vh;
            }
            
            .game-container {
                flex-direction: column;
                align-items: center;
                padding: 10px;
                max-width: 100%;
                box-sizing: border-box;
            }
            
            .info-panel {
                width: 100%;
                max-width: 300px;
                order: 2;
            }
            
            canvas#tetris {
                max-width: 100%;
                height: auto;
                order: 1;
            }
            
            h1 {
                font-size: 1.5em;
                margin-bottom: 10px;
            }
            
            .controls-info {
                font-size: 0.9em;
            }
            
            button {
                padding: 10px;
                font-size: 1em;
            }
        }
        
        /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ —Å–≤–∞–π–ø–∞—Ö –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
        html, body {
            overscroll-behavior: contain;
            touch-action: none;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .mobile-controls {
            display: none; /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç—ã */
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
            width: 100%;
            max-width: 300px;
        }
        
        .mobile-controls-row {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .mobile-controls button {
            width: 60px;
            height: 60px;
            font-size: 24px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .mobile-controls button:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.3);
        }
        
        #rotate-btn, #drop-btn {
            width: 120px;
            border-radius: 30px;
        }
        
        /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
        @media (max-width: 768px) {
            .mobile-controls {
                display: flex;
                order: 3;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="tetris" width="500" height="1000"></canvas>
        
        <!-- –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="mobile-controls">
            <div class="mobile-controls-row">
                <button id="rotate-btn">‚Üë</button>
            </div>
            <div class="mobile-controls-row">
                <button id="left-btn">‚Üê</button>
                <button id="down-btn">‚Üì</button>
                <button id="right-btn">‚Üí</button>
            </div>
            <div class="mobile-controls-row">
                <button id="drop-btn">‚¨áÔ∏è‚¨áÔ∏è</button>
            </div>
        </div>
        
        <div class="info-panel">
            <h1>‚ú® –¢–µ—Ç—Ä–∏—Å ‚ú®</h1>
            
            <div class="score-box">
                <p>üèÜ –°—á–µ—Ç: <span id="score">0</span></p>
                <p>üìä –õ–∏–Ω–∏–∏: <span id="lines">0</span></p>
                <p>üöÄ –£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></p>
            </div>
            
            <div class="score-box">
                <p>üé≤ –°–ª–µ–¥—É—é—â–∞—è —Ñ–∏–≥—É—Ä–∞:</p>
                <canvas id="next" width="120" height="120"></canvas>
            </div>
            
            <button id="start">‚ñ∂Ô∏è –°–¢–ê–†–¢</button>
            
            <div class="controls-info">
                <h3>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</h3>
                <p>‚Üê ‚Üí : –î–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ</p>
                <p>‚Üë : –í—Ä–∞—â–µ–Ω–∏–µ</p>
                <p>‚Üì : –î–≤–∏–∂–µ–Ω–∏–µ –≤–Ω–∏–∑</p>
                <p>–ü—Ä–æ–±–µ–ª : –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–≥—É—Ä—É</p>
                <p>P : –ü–∞—É–∑–∞</p>
                <h3>üì± –ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</h3>
                <p>–°–≤–∞–π–ø –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ: –î–≤–∏–∂–µ–Ω–∏–µ</p>
                <p>–°–≤–∞–π–ø –≤–≤–µ—Ä—Ö: –í—Ä–∞—â–µ–Ω–∏–µ</p>
                <p>–°–≤–∞–π–ø –≤–Ω–∏–∑: –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–≥—É—Ä—É</p>
                <p>–¢–∞–ø: –î–≤–∏–∂–µ–Ω–∏–µ –≤–Ω–∏–∑</p>
                <p>–¢–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
            </div>
        </div>
    </div>

    <script>
        // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
        const canvas = document.getElementById('tetris');
        const context = canvas.getContext('2d');
        const nextCanvas = document.getElementById('next');
        const nextContext = nextCanvas.getContext('2d');
        const startButton = document.getElementById('start');
        
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const BLOCK_SIZE = 25; // –†–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
        const ROWS = 40;       // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –≤ 2 —Ä–∞–∑–∞ (–±—ã–ª–æ 20)
        const COLS = 20;       // –®–∏—Ä–æ–∫–∏–π —Å—Ç–∞–∫–∞–Ω
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ö–æ–ª—Å—Ç–∞ –¥–ª—è –∏–¥–µ–∞–ª—å–Ω—ã—Ö –∫–≤–∞–¥—Ä–∞—Ç–æ–≤
        canvas.style.width = `${COLS * BLOCK_SIZE}px`;
        canvas.style.height = `${ROWS * BLOCK_SIZE}px`;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let dropCounter = 0;
        let dropInterval = 1000;
        let lastTime = 0;
        let score = 0;
        let lines = 0;
        let level = 1;
        let paused = false;
        let gameOver = true;
        
        // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
        const arena = createMatrix(COLS, ROWS);
        
        // –ò–≥—Ä–æ–∫
        const player = {
            pos: {x: 0, y: 0},
            matrix: null,
            next: null,
            score: 0
        };
        
        // –¶–≤–µ—Ç–∞ —Ñ–∏–≥—É—Ä —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏ (3D-—ç—Ñ—Ñ–µ–∫—Ç)
        const colors = [
            null,
            {main: '#FF4136', light: '#FF725C', dark: '#E7040F'}, // –ö—Ä–∞—Å–Ω—ã–π
            {main: '#2ECC40', light: '#9EEBCF', dark: '#137752'}, // –ó–µ–ª–µ–Ω—ã–π
            {main: '#0074D9', light: '#7FDBFF', dark: '#00449E'}, // –°–∏–Ω–∏–π
            {main: '#FFDC00', light: '#FFFCEB', dark: '#FFD700'}, // –ñ–µ–ª—Ç—ã–π
            {main: '#B10DC9', light: '#F6D8FF', dark: '#5E2CA5'}, // –§–∏–æ–ª–µ—Ç–æ–≤—ã–π
            {main: '#FF851B', light: '#FFE8D9', dark: '#D86E00'}, // –û—Ä–∞–Ω–∂–µ–≤—ã–π
            {main: '#01FF70', light: '#E8FDF5', dark: '#00A86B'},  // –ë–∏—Ä—é–∑–æ–≤—ã–π
            {main: '#F012BE', light: '#FFCEF3', dark: '#85144b'}, // –†–æ–∑–æ–≤—ã–π
            {main: '#7FDBFF', light: '#E4F9FF', dark: '#0074D9'}, // –ì–æ–ª—É–±–æ–π
            {main: '#39CCCC', light: '#E5FFFF', dark: '#2EAD88'}, // –ê–∫–≤–∞–º–∞—Ä–∏–Ω
            {main: '#3D9970', light: '#C4F9EB', dark: '#1A5336'}, // –û–ª–∏–≤–∫–æ–≤—ã–π
            {main: '#AAAAAA', light: '#EEEEEE', dark: '#666666'}, // –°–µ—Ä—ã–π
            {main: '#FF4136', light: '#FF725C', dark: '#E7040F'}, // –ö—Ä–∞—Å–Ω—ã–π (–ø–æ–≤—Ç–æ—Ä)
            {main: '#2ECC40', light: '#9EEBCF', dark: '#137752'}  // –ó–µ–ª–µ–Ω—ã–π (–ø–æ–≤—Ç–æ—Ä)
        ];
        
        // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã –¢–µ—Ç—Ä–∏—Å–∞
        const standardPieces = [
            // T-–æ–±—Ä–∞–∑–Ω–∞—è —Ñ–∏–≥—É—Ä–∞
            [
                [0, 1, 0],
                [1, 1, 1]
            ],
            // L-–æ–±—Ä–∞–∑–Ω–∞—è —Ñ–∏–≥—É—Ä–∞
            [
                [0, 0, 2],
                [2, 2, 2]
            ],
            // J-–æ–±—Ä–∞–∑–Ω–∞—è —Ñ–∏–≥—É—Ä–∞
            [
                [3, 0, 0],
                [3, 3, 3]
            ],
            // –ö–≤–∞–¥—Ä–∞—Ç
            [
                [4, 4],
                [4, 4]
            ],
            // Z-–æ–±—Ä–∞–∑–Ω–∞—è —Ñ–∏–≥—É—Ä–∞
            [
                [5, 5, 0],
                [0, 5, 5]
            ],
            // –ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞—è T-–æ–±—Ä–∞–∑–Ω–∞—è —Ñ–∏–≥—É—Ä–∞
            [
                [0, 6, 0],
                [6, 6, 6]
            ],
            // S-–æ–±—Ä–∞–∑–Ω–∞—è —Ñ–∏–≥—É—Ä–∞
            [
                [0, 7, 7],
                [7, 7, 0]
            ],
            // I-–æ–±—Ä–∞–∑–Ω–∞—è —Ñ–∏–≥—É—Ä–∞ (–ª–∏–Ω–∏—è)
            [
                [8, 8, 8, 8]
            ]
        ];
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–Ω–¥–æ–º–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã —Ä–∞–∑–º–µ—Ä–æ–º –æ—Ç 1 –¥–æ 4 –±–ª–æ–∫–æ–≤
        const additionalPieces = [
            // –û–¥–∏–Ω–æ—á–Ω—ã–π –±–ª–æ–∫
            [
                [9]
            ],
            // –î–≤–æ–π–Ω—ã–µ –±–ª–æ–∫–∏ (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ)
            [
                [10, 10]
            ],
            [
                [11],
                [11]
            ],
            // –¢—Ä–æ–π–Ω—ã–µ –±–ª–æ–∫–∏ (—Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—ã)
            [
                [12, 12, 12]
            ],
            [
                [13],
                [13],
                [13]
            ],
            [
                [14, 14],
                [14, 0]
            ],
            [
                [15, 15],
                [0, 15]
            ]
        ];
        
        // –§–∏–≥—É—Ä—ã –∏–∑ 5 –±–ª–æ–∫–æ–≤
        const pentominoePieces = [
            // I-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ (–¥–ª–∏–Ω–Ω–∞—è –ª–∏–Ω–∏—è)
            [
                [1, 1, 1, 1, 1]
            ],
            // L-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [2, 0, 0, 0],
                [2, 2, 2, 2]
            ],
            // J-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [0, 0, 0, 3],
                [3, 3, 3, 3]
            ],
            // T-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [0, 4, 0],
                [0, 4, 0],
                [4, 4, 4]
            ],
            // U-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [5, 0, 5],
                [5, 5, 5]
            ],
            // X-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ (–∫—Ä–µ—Å—Ç)
            [
                [0, 6, 0],
                [6, 6, 6],
                [0, 6, 0]
            ],
            // Z-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [7, 7, 0],
                [0, 7, 0],
                [0, 7, 7]
            ],
            // S-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [0, 8, 8],
                [0, 8, 0],
                [8, 8, 0]
            ],
            // P-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [9, 9],
                [9, 9],
                [9, 0]
            ],
            // F-–ø–µ–Ω—Ç–æ–º–∏–Ω–æ
            [
                [0, 10, 10],
                [10, 10, 0],
                [0, 10, 0]
            ]
        ];
        
        // –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —Ñ–∏–≥—É—Ä—ã
        const pieces = [...standardPieces, ...additionalPieces, ...pentominoePieces];
        
        // –§—É–Ω–∫—Ü–∏–∏
        function createMatrix(w, h) {
            const matrix = [];
            while (h--) {
                matrix.push(new Array(w).fill(0));
            }
            return matrix;
        }
        
        function createPiece(type) {
            if (type < 0 || type >= pieces.length) {
                console.error("Invalid piece type:", type);
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–≤–∞–¥—Ä–∞—Ç (–∏–Ω–¥–µ–∫—Å 3) –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                return JSON.parse(JSON.stringify(pieces[3]));
            }
            // –°–æ–∑–¥–∞–µ–º –≥–ª—É–±–æ–∫—É—é –∫–æ–ø–∏—é —Ñ–∏–≥—É—Ä—ã
            return JSON.parse(JSON.stringify(pieces[type]));
        }
        
        function drawMatrix(matrix, offset, ctx) {
            matrix.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        // –ü–æ–ª—É—á–∞–µ–º —Ü–≤–µ—Ç–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±–ª–æ–∫–∞
                        const colorIndex = value % colors.length;
                        const colorSet = colors[colorIndex === 0 ? 1 : colorIndex];
                        
                        // –†–∏—Å—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫
                        ctx.fillStyle = colorSet.main;
                        ctx.fillRect(
                            (x + offset.x) * BLOCK_SIZE,
                            (y + offset.y) * BLOCK_SIZE,
                            BLOCK_SIZE, BLOCK_SIZE
                        );
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–µ—Å–∫ (—Å–≤–µ—Ç–ª–∞—è —á–∞—Å—Ç—å)
                        ctx.fillStyle = colorSet.light;
                        ctx.fillRect(
                            (x + offset.x) * BLOCK_SIZE,
                            (y + offset.y) * BLOCK_SIZE,
                            BLOCK_SIZE, BLOCK_SIZE / 4
                        );
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–Ω—å (—Ç–µ–º–Ω–∞—è —á–∞—Å—Ç—å)
                        ctx.fillStyle = colorSet.dark;
                        ctx.fillRect(
                            (x + offset.x) * BLOCK_SIZE,
                            (y + offset.y) * BLOCK_SIZE + BLOCK_SIZE * 3/4,
                            BLOCK_SIZE, BLOCK_SIZE / 4
                        );
                        
                        // –†–∏—Å—É–µ–º –≥—Ä–∞–Ω–∏—Ü—É –±–ª–æ–∫–∞
                        ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(
                            (x + offset.x) * BLOCK_SIZE,
                            (y + offset.y) * BLOCK_SIZE,
                            BLOCK_SIZE, BLOCK_SIZE
                        );
                    }
                });
            });
        }
        
        function draw() {
            // –û—á–∏—â–∞–µ–º —Ö–æ–ª—Å—Ç
            context.fillStyle = 'rgba(0, 0, 0, 0.3)';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É
            context.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            context.lineWidth = 1;
            
            for (let x = 0; x <= COLS; x++) {
                context.beginPath();
                context.moveTo(x * BLOCK_SIZE, 0);
                context.lineTo(x * BLOCK_SIZE, ROWS * BLOCK_SIZE);
                context.stroke();
            }
            
            for (let y = 0; y <= ROWS; y++) {
                context.beginPath();
                context.moveTo(0, y * BLOCK_SIZE);
                context.lineTo(COLS * BLOCK_SIZE, y * BLOCK_SIZE);
                context.stroke();
            }
            
            // –†–∏—Å—É–µ–º –∞—Ä–µ–Ω—É
            drawMatrix(arena, {x: 0, y: 0}, context);
            
            // –†–∏—Å—É–µ–º —Ç–µ–∫—É—â—É—é —Ñ–∏–≥—É—Ä—É
            if (player.matrix) {
                drawMatrix(player.matrix, player.pos, context);
            }
            
            // –†–∏—Å—É–µ–º —Å–ª–µ–¥—É—é—â—É—é —Ñ–∏–≥—É—Ä—É
            nextContext.fillStyle = 'rgba(0, 0, 0, 0.3)';
            nextContext.fillRect(0, 0, nextCanvas.width, nextCanvas.height);
            
            if (player.next) {
                const offset = {
                    x: (nextCanvas.width / BLOCK_SIZE - player.next[0].length) / 2,
                    y: (nextCanvas.height / BLOCK_SIZE - player.next.length) / 2
                };
                drawMatrix(player.next, offset, nextContext);
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–∞—É–∑—É
            if (paused) {
                context.fillStyle = 'rgba(0, 0, 0, 0.7)';
                context.fillRect(0, 0, canvas.width, canvas.height);
                
                context.font = '30px Arial';
                context.fillStyle = 'white';
                context.textAlign = 'center';
                context.fillText('–ü–ê–£–ó–ê', canvas.width / 2, canvas.height / 2);
            }
        }
        
        function merge(arena, player) {
            player.matrix.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        arena[y + player.pos.y][x + player.pos.x] = value;
                    }
                });
            });
        }
        
        function collide(arena, player) {
            const [m, o] = [player.matrix, player.pos];
            for (let y = 0; y < m.length; ++y) {
                for (let x = 0; x < m[y].length; ++x) {
                    if (m[y][x] !== 0 &&
                        (arena[y + o.y] === undefined ||
                         arena[y + o.y][x + o.x] === undefined ||
                         arena[y + o.y][x + o.x] !== 0)) {
                        return true;
                    }
                }
            }
            return false;
        }
        
        function rotate(matrix, dir) {
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –º–∞—Ç—Ä–∏—Ü—É –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤—Ä–∞—â–µ–Ω–∏—è
            const N = matrix.length;
            const M = matrix[0].length;
            let result = [];
            
            if (dir > 0) { // –ü–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ
                for (let i = 0; i < M; i++) {
                    let newRow = [];
                    for (let j = N - 1; j >= 0; j--) {
                        newRow.push(matrix[j][i]);
                    }
                    result.push(newRow);
                }
            } else { // –ü—Ä–æ—Ç–∏–≤ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–∏
                for (let i = M - 1; i >= 0; i--) {
                    let newRow = [];
                    for (let j = 0; j < N; j++) {
                        newRow.push(matrix[j][i]);
                    }
                    result.push(newRow);
                }
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –º–∞—Ç—Ä–∏—Ü—É –≤–º–µ—Å—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–π
            const rotatedMatrix = [];
            for (let i = 0; i < result.length; i++) {
                rotatedMatrix.push([...result[i]]);
            }
            
            // –ó–∞–º–µ–Ω—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏—Å—Ö–æ–¥–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã
            matrix.length = 0; // –û—á–∏—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—É—é –º–∞—Ç—Ä–∏—Ü—É
            for (let i = 0; i < rotatedMatrix.length; i++) {
                matrix.push(rotatedMatrix[i]);
            }
        }
        
        function playerRotate(dir) {
            const originalPos = {
                x: player.pos.x,
                y: player.pos.y
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –º–∞—Ç—Ä–∏—Ü—É
            const originalMatrix = JSON.parse(JSON.stringify(player.matrix));
            
            // –í—Ä–∞—â–∞–µ–º –º–∞—Ç—Ä–∏—Ü—É
            rotate(player.matrix, dir);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –ª–∏ —Ñ–∏–≥—É—Ä–∞ –∑–∞ –ø—Ä–∞–≤—É—é –≥—Ä–∞–Ω–∏—Ü—É
            const rightOverhang = player.pos.x + player.matrix[0].length - COLS;
            if (rightOverhang > 0) {
                player.pos.x -= rightOverhang;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –ª–∏ —Ñ–∏–≥—É—Ä–∞ –∑–∞ –ª–µ–≤—É—é –≥—Ä–∞–Ω–∏—Ü—É
            if (player.pos.x < 0) {
                player.pos.x = 0;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –ª–∏ —Ñ–∏–≥—É—Ä–∞ –∑–∞ –Ω–∏–∂–Ω—é—é –≥—Ä–∞–Ω–∏—Ü—É
            const bottomOverhang = player.pos.y + player.matrix.length - ROWS;
            if (bottomOverhang > 0) {
                player.pos.y -= bottomOverhang;
            }
            
            // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –ø–æ–∑–∏—Ü–∏—é, –≥–¥–µ —Ñ–∏–≥—É—Ä–∞ –Ω–µ –±—É–¥–µ—Ç —Å—Ç–∞–ª–∫–∏–≤–∞—Ç—å—Å—è
            let offset = 1;
            let attempts = 0;
            const maxAttempts = Math.max(player.matrix[0].length, player.matrix.length) * 2;
            
            while (collide(arena, player)) {
                player.pos.x += offset;
                offset = -(offset + (offset > 0 ? 1 : -1));
                attempts++;
                
                // –ï—Å–ª–∏ –Ω–µ –º–æ–∂–µ–º —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Ñ–∏–≥—É—Ä—É –ø–æ—Å–ª–µ –≤—Ä–∞—â–µ–Ω–∏—è –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏,
                // –ø—Ä–æ–±—É–µ–º —Å–¥–≤–∏–Ω—É—Ç—å –≤–≤–µ—Ä—Ö
                if (Math.abs(offset) > player.matrix[0].length) {
                    player.pos.x = originalPos.x;
                    player.pos.y--;
                    offset = 1;
                }
                
                // –ï—Å–ª–∏ –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ —É–¥–∞–ª–∏—Å—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—É—é —Ñ–∏–≥—É—Ä—É
                if (attempts > maxAttempts) {
                    player.matrix = originalMatrix;
                    player.pos.x = originalPos.x;
                    player.pos.y = originalPos.y;
                    return;
                }
            }
        }
        
        function playerDrop() {
            player.pos.y++;
            if (collide(arena, player)) {
                player.pos.y--;
                merge(arena, player);
                playerReset();
                arenaSweep();
                updateScore();
            }
            dropCounter = 0;
        }
        
        function playerMove(offset) {
            player.pos.x += offset;
            if (collide(arena, player)) {
                player.pos.x -= offset;
            }
        }
        
        function playerHardDrop() {
            while (!collide(arena, player)) {
                player.pos.y++;
            }
            player.pos.y--;
            merge(arena, player);
            playerReset();
            arenaSweep();
            updateScore();
            dropCounter = 0;
        }
        
        function playerReset() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é —Ñ–∏–≥—É—Ä—É –∫–∞–∫ —Ç–µ–∫—É—â—É—é
            if (player.next === null) {
                player.matrix = createPiece(Math.floor(Math.random() * pieces.length));
            } else {
                player.matrix = player.next;
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å–ª–µ–¥—É—é—â—É—é —Ñ–∏–≥—É—Ä—É
            player.next = createPiece(Math.floor(Math.random() * pieces.length));
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
            player.pos.y = 0;
            player.pos.x = Math.floor((arena[0].length - player.matrix[0].length) / 2);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–Ω–µ—Ü –∏–≥—Ä—ã
            if (collide(arena, player)) {
                // –û—á–∏—â–∞–µ–º –∞—Ä–µ–Ω—É
                arena.forEach(row => row.fill(0));
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç
                player.score = 0;
                score = 0;
                lines = 0;
                level = 1;
                updateScore();
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã
                gameOver = true;
                paused = false;
                startButton.textContent = '‚ñ∂Ô∏è –°–¢–ê–†–¢';
            }
        }
        
        function arenaSweep() {
            let rowCount = 0;
            let rowsToRemove = [];
            
            // –ù–∞—Ö–æ–¥–∏–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
            for (let y = arena.length - 1; y >= 0; --y) {
                if (arena[y].every(value => value !== 0)) {
                    rowsToRemove.push(y);
                    rowCount++;
                }
            }
            
            if (rowCount > 0) {
                // –ê–Ω–∏–º–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫
                animateRowClear(rowsToRemove, () => {
                    // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏ –≤ –ø–æ—Ä—è–¥–∫–µ —É–±—ã–≤–∞–Ω–∏—è
                    rowsToRemove.sort((a, b) => b - a);
                    
                    // –£–¥–∞–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏
                    rowsToRemove.forEach(y => {
                        arena.splice(y, 1);
                        arena.unshift(new Array(COLS).fill(0));
                    });
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç
                    player.score += rowCount * 10 * level;
                    lines += rowCount;
                    level = Math.floor(lines / 10) + 1;
                    dropInterval = 1000 / level;
                    
                    updateScore();
                });
            }
        }
        
        function animateRowClear(rows, callback) {
            const originalRows = rows.map(y => [...arena[y]]);
            let animationStep = 0;
            const totalSteps = 10;
            
            function animate() {
                if (animationStep >= totalSteps) {
                    callback();
                    return;
                }
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –º–∏–≥–∞–Ω–∏—è –∏ –¥–≤–∏–∂–µ–Ω–∏—è —Å—Ç—Ä–æ–∫
                rows.forEach((y, index) => {
                    // –ß–µ—Ä–µ–¥—É–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ –∏ –≤–ø—Ä–∞–≤–æ
                    const direction = index % 2 === 0 ? 1 : -1;
                    const offset = Math.sin(animationStep / totalSteps * Math.PI) * 3 * direction;
                    
                    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                    const tempRow = new Array(COLS).fill(0);
                    
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å—Ç—Ä–æ–∫—É —Å —É—á–µ—Ç–æ–º —Å–º–µ—â–µ–Ω–∏—è
                    for (let x = 0; x < COLS; x++) {
                        const sourceX = Math.floor(x - offset);
                        if (sourceX >= 0 && sourceX < COLS) {
                            tempRow[x] = originalRows[index][sourceX];
                        }
                    }
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É
                    arena[y] = tempRow;
                });
                
                // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –∫–∞–¥—Ä
                draw();
                
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É –∞–Ω–∏–º–∞—Ü–∏–∏
                animationStep++;
                requestAnimationFrame(animate);
            }
            
            animate();
        }
        
        function updateScore() {
            document.getElementById('score').textContent = player.score;
            document.getElementById('lines').textContent = lines;
            document.getElementById('level').textContent = level;
        }
        
        function togglePause() {
            paused = !paused;
            if (paused) {
                startButton.textContent = '‚ñ∂Ô∏è –ü–†–û–î–û–õ–ñ–ò–¢–¨';
            } else {
                startButton.textContent = '‚è∏Ô∏è –ü–ê–£–ó–ê';
            }
        }
        
        function update(time = 0) {
            const deltaTime = time - lastTime;
            lastTime = time;
            
            if (!gameOver && !paused) {
                dropCounter += deltaTime;
                if (dropCounter > dropInterval) {
                    playerDrop();
                }
            }
            
            draw();
            requestAnimationFrame(update);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            // –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤—É—é —Ñ–∏–≥—É—Ä—É –∏ —Å–ª–µ–¥—É—é—â—É—é —Ñ–∏–≥—É—Ä—É
            player.matrix = createPiece(Math.floor(Math.random() * pieces.length));
            player.next = createPiece(Math.floor(Math.random() * pieces.length));
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
            player.pos.y = 0;
            player.pos.x = Math.floor((arena[0].length - player.matrix[0].length) / 2);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç
            updateScore();
            
            // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            draw();
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        document.addEventListener('keydown', event => {
            if (gameOver) return;
            
            switch (event.keyCode) {
                case 37: // –°—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ
                    playerMove(-1);
                    break;
                case 39: // –°—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ
                    playerMove(1);
                    break;
                case 40: // –°—Ç—Ä–µ–ª–∫–∞ –≤–Ω–∏–∑
                    playerDrop();
                    break;
                case 38: // –°—Ç—Ä–µ–ª–∫–∞ –≤–≤–µ—Ä—Ö
                    playerRotate(1);
                    break;
                case 32: // –ü—Ä–æ–±–µ–ª
                    event.preventDefault();
                    playerHardDrop();
                    break;
                case 80: // –ö–ª–∞–≤–∏—à–∞ 'P'
                    togglePause();
                    break;
            }
        });
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–≤–∞–π–ø–æ–≤
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;
        
        // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤–∞–π–ø–∞
        const minSwipeDistance = 30;
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–µ–Ω—Å–æ—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Å–≤–∞–π–ø–æ–≤
        canvas.addEventListener('touchstart', function(event) {
            event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
            touchStartX = event.changedTouches[0].screenX;
            touchStartY = event.changedTouches[0].screenY;
        }, { passive: false });
        
        canvas.addEventListener('touchmove', function(event) {
            event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        }, { passive: false });
        
        canvas.addEventListener('touchend', function(event) {
            event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
            if (gameOver || paused) return;
            
            touchEndX = event.changedTouches[0].screenX;
            touchEndY = event.changedTouches[0].screenY;
            
            handleSwipe();
        }, { passive: false });
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–≤–∞–π–ø–∞
        function handleSwipe() {
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –±—ã–ª –ª–∏ —Å–≤–∞–π–ø –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª–∏–Ω–Ω—ã–º
            if (Math.abs(deltaX) > minSwipeDistance || Math.abs(deltaY) > minSwipeDistance) {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∞–π–ø–∞
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
                    if (deltaX > 0) {
                        // –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ
                        playerMove(1);
                    } else {
                        // –°–≤–∞–π–ø –≤–ª–µ–≤–æ
                        playerMove(-1);
                    }
                } else {
                    // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
                    if (deltaY > 0) {
                        // –°–≤–∞–π–ø –≤–Ω–∏–∑
                        playerHardDrop(); // –ë—ã—Å—Ç—Ä–æ–µ –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–∏ —Å–≤–∞–π–ø–µ –≤–Ω–∏–∑
                    } else {
                        // –°–≤–∞–π–ø –≤–≤–µ—Ä—Ö
                        playerRotate(1); // –í—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–∏ —Å–≤–∞–π–ø–µ –≤–≤–µ—Ä—Ö
                    }
                }
            } else {
                // –ö–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∂–∞—Ç–∏–µ (—Ç–∞–ø) - –º—è–≥–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ
                playerDrop();
            }
        }
        
        startButton.addEventListener('click', () => {
            if (gameOver) {
                gameOver = false;
                player.score = 0;
                score = 0;
                lines = 0;
                level = 1;
                updateScore();
                playerReset();
                startButton.textContent = '‚è∏Ô∏è –ü–ê–£–ó–ê';
            } else {
                togglePause();
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        document.getElementById('left-btn').addEventListener('click', () => {
            if (!gameOver && !paused) playerMove(-1);
        });
        
        document.getElementById('right-btn').addEventListener('click', () => {
            if (!gameOver && !paused) playerMove(1);
        });
        
        document.getElementById('down-btn').addEventListener('click', () => {
            if (!gameOver && !paused) playerDrop();
        });
        
        document.getElementById('rotate-btn').addEventListener('click', () => {
            if (!gameOver && !paused) playerRotate(1);
        });
        
        document.getElementById('drop-btn').addEventListener('click', () => {
            if (!gameOver && !paused) playerHardDrop();
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏
        document.querySelectorAll('.mobile-controls button').forEach(button => {
            button.addEventListener('touchstart', e => e.preventDefault());
            button.addEventListener('touchend', e => e.preventDefault());
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–µ—Å—Ç–∫–∏ –Ω–∞ —Ñ–æ–Ω
        function createSparkles() {
            const container = document.querySelector('.game-container');
            for (let i = 0; i < 30; i++) {
                const sparkle = document.createElement('div');
                sparkle.classList.add('sparkle');
                sparkle.style.left = `${Math.random() * 100}%`;
                sparkle.style.top = `${Math.random() * 100}%`;
                sparkle.style.animationDelay = `${Math.random() * 2}s`;
                container.appendChild(sparkle);
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ö–æ–ª—Å—Ç–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∏–≥—É—Ä—ã
        nextCanvas.style.width = `${120}px`;
        nextCanvas.style.height = `${120}px`;
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        initGame();
        update();
        createSparkles();
    </script>
</body>
</html>
